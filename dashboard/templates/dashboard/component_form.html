{%extends 'theme/base.html'%}
{% load static %}

{%block title%}{% if is_edit %}Edit Component{% else %}Create Component{% endif %}{%endblock%}

{% block nav_content %}
<div class="flex justify-end items-center h-full">
    <ul class="menu menu-horizontal p-0 hidden lg:flex text-white space-x-2">
        <li><a id="logout_btn" href="{% url 'logout' %}"
                class="btn btn-ghost text-white hover:bg-blue-800 transition duration-200">Log out</a></li>
        <li><a href="#" class="btn btn-ghost text-white hover:bg-blue-800 transition duration-200">Account</a></li>
    </ul>

    <label for="my-drawer" class="btn btn-square btn-ghost text-white lg:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            class="inline-block w-6 h-6 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </label>
</div>
{% endblock %}

{%block content%}

<div class="drawer h-full overflow-hidden">
    <input id="my-drawer" type="checkbox" class="drawer-toggle" />

    <div class="drawer-content flex flex-col h-full overflow-hidden">

        <main class="flex flex-1 h-full overflow-hidden">

            <!-- SIDEBAR -->
            <aside
                class="hidden lg:block w-64 bg-white p-6 shadow-xl border-r border-gray-200 flex-shrink-0 overflow-y-auto">
                {% include 'formula_app/includes/sidebar.html' %}
            </aside>
            <!-- END SIDEBAR -->

            <!-- MAIN CONTENT -->
            <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                <!-- Breadcrumb -->
                <nav class="mb-6">
                    <ol class="flex items-center gap-2 text-sm">
                        <li class="flex items-center">
                            <a href="{% url 'dashboard_home' %}"
                                class="flex items-center gap-2 px-3 py-2 rounded-md text-gray-600 hover:text-blue-950 hover:bg-blue-50 transition-all duration-200 group">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    class="w-4 h-4 stroke-current group-hover:scale-110 transition-transform">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                                    </path>
                                </svg>
                                <span class="font-medium">Dashboard</span>
                            </a>
                        </li>

                        <li class="flex items-center text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </li>

                        <li class="flex items-center">
                            <a href="{% url 'components_home' %}"
                                class="flex items-center gap-2 px-3 py-2 rounded-md text-gray-600 hover:text-blue-950 hover:bg-blue-50 transition-all duration-200 group">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    class="w-4 h-4 stroke-current group-hover:scale-110 transition-transform">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                                    </path>
                                </svg>
                                <span class="font-medium">Components</span>
                            </a>
                        </li>

                        <li class="flex items-center text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </li>

                        <li class="flex items-center">
                            <span class="flex items-center gap-2 px-3 py-2 rounded-md bg-blue-950 text-white shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    class="w-4 h-4 stroke-current">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                    </path>
                                </svg>
                                <span class="font-semibold">{% if is_edit %}Edit{% else %}Create{% endif %}
                                    Component</span>
                            </span>
                        </li>
                    </ol>
                </nav>

                <!-- Page Header -->
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-blue-950">
                        {% if is_edit %}Edit Component{% else %}Create New Component{% endif %}
                    </h1>
                    <div class="flex gap-2">
                        {% if is_edit and component.equipment %}
                        <a href="#" class="btn bg-purple-600 hover:bg-purple-700 text-white border-none">View
                            Equipment</a>
                        {% endif %}
                        <a href="{% url 'components_home' %}"
                            class="btn btn-ghost text-blue-950 hover:bg-blue-100">Cancel</a>
                        <button type="submit" form="component-form"
                            class="btn bg-blue-950 hover:bg-blue-900 text-white border-none px-8">
                            {% if is_edit %}Save Changes{% else %}Create Component{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs tabs-boxed bg-white shadow-md mb-2">
                    <a class="tab tab-active text-blue-950 font-semibold">Data</a>
                    <a class="tab text-gray-500" disabled>Metal Loss</a>
                    <a class="tab text-gray-500" disabled>Non-Metal Loss</a>
                    <a class="tab text-gray-500" disabled>Probability</a>
                    <a class="tab text-gray-500" disabled>Consequence</a>
                    <a class="tab text-gray-500" disabled>Risk</a>
                    <a class="tab text-gray-500" disabled>Inspection</a>
                </div>

                <!-- Styles for custom purple theme -->
                <form method="post" id="component-form">
                    {% csrf_token %}

                    <!-- Sub-tabs for Data section -->
                    <div class="flex gap-2 mb-6 bg-gray-100 p-2 rounded-lg border border-gray-200">
                        <button type="button"
                            class="btn btn-sm bg-blue-950 hover:bg-blue-900 text-white border-none shadow-md font-semibold"
                            onclick="showSubTab('design', this)">Design / Installation</button>
                        <button type="button" class="btn btn-sm bg-gray-200 hover:bg-gray-300 text-gray-700 border-none"
                            onclick="showSubTab('operating', this)">Operating & Process</button>
                        <button type="button" class="btn btn-sm bg-gray-200 hover:bg-gray-300 text-gray-700 border-none"
                            onclick="showSubTab('inspection', this)">Inspection</button>
                    </div>

                    <!-- Design / Installation Section -->

                    <div id="design-section" class="bg-white shadow-md rounded-lg p-6">
                        <h2
                            class="text-lg font-bold mb-6 bg-purple-600 text-blue-950 py-2 px-4 -mx-6 -mt-6 rounded-t-lg">
                            Design / Installation</h2>

                        <div class="space-y-4">
                            <!-- Row 1: Equipment -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-control md:col-span-2">
                                    <label class="label"><span
                                            class="label-text font-semibold text-gray-700">Equipment</span></label>
                                    {{ form.equipment }}
                                </div>
                            </div>

                            <!-- Row 2: Equipment Type & Component Type -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">RBIX
                                            Equipment Type</span></label>
                                    {{ form.rbix_equipment_type }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">RBIX
                                            Component Type</span></label>
                                    {{ form.rbix_component_type }}
                                </div>
                            </div>

                            <!-- Row 3: Description -->
                            <div class="form-control w-full">
                                <label class="label"><span
                                        class="label-text font-semibold text-gray-700">Description</span></label>
                                {{ form.description }}
                            </div>

                            <!-- Row 4: PFD, P&ID, Other Drawings -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span
                                            class="label-text font-semibold text-gray-700">PFD</span></label>
                                    {{ form.pfd_no }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span
                                            class="label-text font-semibold text-gray-700">P&ID</span></label>
                                    {{ form.p_and_id }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Other
                                            Drawings</span></label>
                                    {{ form.other_drawings }}
                                </div>
                            </div>

                            <!-- Row 5: Dates and Lives Setup -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span
                                            class="label-text font-semibold text-gray-700">Commissioning
                                            Date</span></label>
                                    {{ form.commissioning_date }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">RBI
                                            Calculation Date</span></label>
                                    {{ form.rbi_calculation_date }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Design
                                            Life (years)</span></label>
                                    {{ form.design_life_years }}
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Component
                                            Life
                                            (years)</span></label>
                                    {{ form.component_life_years }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Remaining
                                            Life
                                            (years)</span></label>
                                    {{ form.remaining_life_years }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">External
                                            Coating
                                            Installation Date</span></label>
                                    {{ form.external_coating_date }}
                                </div>
                            </div>

                            <!-- Material Section -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                                <div class="form-control">
                                    <label class="label"><span
                                            class="label-text font-semibold text-gray-700">Material</span></label>
                                    {{ form.material }}
                                </div>
                                <div class="form-control">
                                    <button type="button"
                                        class="btn bg-blue-950 text-white hover:bg-blue-900 btn-block">Select
                                        Material</button>
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-blue-950">RBIX
                                            Material</span></label>
                                    <input type="text" class="input input-bordered bg-gray-100" readonly
                                        value="Carbon steel">
                                </div>
                                <div class="form-control">
                                    <input type="text" class="input input-bordered bg-gray-100" readonly
                                        value="Carbon Steel A 516">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-purple-700">RBIX
                                            Material Nominal Composition</span></label>
                                    {{ form.material_nominal_composition }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-purple-700">RBIX
                                            Material Specification No</span></label>
                                    {{ form.material_specification_no }}
                                </div>
                                <div class="form-control flex flex-row items-center gap-2 pt-8">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-gray-700">Sulphur Bearing
                                            Compounds</span>
                                        {{ form.sulphur_bearing_compounds }}
                                    </label>
                                </div>
                            </div>

                            <!-- Design Conditions -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Design
                                            Pressure (psi)</span></label>
                                    {{ form.design_pressure_psi }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Design
                                            Temp. (deg F)</span></label>
                                    {{ form.design_temp_f }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">MDMT
                                            (deg F)</span></label>
                                    {{ form.mdmt_f }}
                                </div>
                            </div>

                            <!-- Stress / Strength -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                <div class="form-control flex flex-row items-center gap-2">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-purple-700">Stress / Strength
                                            Known</span>
                                        {{ form.stress_strength_known }}
                                    </label>
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Allowable
                                            Stress
                                            (psi)</span></label>
                                    {{ form.allowable_stress_psi }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">SMYS
                                            (Yield)(psi)</span></label>
                                    {{ form.smys_yield_psi }}
                                </div>
                            </div>

                            <!-- Dimensions: Diameter -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Size Diameter (Rating)</span></label>
                                    {{ form.size_diameter_rating }}
                                </div>
                                <!-- Note: Reusing existing component_diameter for the "inches" field shown in mockup -->
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-purple-700">Size
                                            Diameter (inches)</span></label>
                                    {{ form.component_diameter }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Size
                                            Diameter (mm)</span></label>
                                    <input type="text" class="input input-bordered bg-gray-100" readonly value="">
                                </div>
                            </div>

                            <!-- Dimensions: Thickness -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                                <div class="form-control flex flex-row items-center gap-2">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-purple-700">Nominal Thickness
                                            Known</span>
                                        {{ form.nominal_thickness_known }}
                                    </label>
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">NT
                                            (inch)</span></label>
                                    {{ form.nominal_thickness_in }}
                                </div>
                                <div></div>
                            </div>

                            <!-- Dimensions: OD/ID/Safety -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Outside
                                            Diameter(in)</span></label>
                                    {{ form.diameter_outside_in }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Inside Diameter(in)</span></label>
                                    {{ form.diameter_inside_in }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Safety Factor</span></label>
                                    {{ form.safety_factor }}
                                </div>
                            </div>

                            <!-- Codes -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-purple-700">Design Code</span></label>
                                    {{ form.design_code }}
                                </div>
                                <div class="form-control flex flex-row items-center gap-2 mb-3">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-purple-700">PWHT</span>
                                        {{ form.pwht }}
                                    </label>
                                </div>
                                <div class="form-control flex flex-row items-center gap-2 mb-3">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-purple-700">Heat Traced</span>
                                        {{ form.heat_traced }}
                                    </label>
                                </div>
                            </div>

                            <!-- Corrosion/Insulation -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Atmosphere Corrosivity</span></label>
                                    {{ form.atmosphere_corrosivity }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Joint Efficiency (0 to 1)</span></label>
                                    {{ form.joint_efficiency }}
                                </div>
                                <div class="form-control flex flex-row items-center gap-2 mb-3">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-purple-700">Internal
                                            Cladding</span>
                                        {{ form.internal_cladding }}
                                    </label>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control flex flex-row items-center gap-2">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-purple-700">Internal
                                            Lining</span>
                                        {{ form.internal_lining }}
                                    </label>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                                <div class="form-control flex flex-row items-center gap-2 mb-3">
                                    <label class="label cursor-pointer justify-start gap-4">
                                        <span class="label-text font-semibold text-gray-700">Insulated</span>
                                        {{ form.insulated }}
                                    </label>
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Insulation Type</span></label>
                                    {{ form.insulation_type }}
                                </div>
                                <div class="form-control">
                                    <label class="label"><span class="label-text font-semibold text-gray-700">Other Insulation</span></label>
                                    {{ form.other_insulation }}
                                </div>
                            </div>

                        </div>

                        <!-- 4.12 Financial Consequence -->
                        <div class="mt-8 pt-8 border-t-2 border-gray-200">
                            <h3 class="text-lg font-bold text-blue-950 mb-6 bg-green-50 py-3 px-4 -mx-6 rounded">
                                Financial Consequence
                            </h3>

                            <!-- 4.12.2 Component Damage Cost -->
                            <div class="mb-8">
                                <h4 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Component Damage
                                    Cost</h4>
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text text-blue-950 font-semibold">Material of
                                                Construction (Table 4.16)</span>
                                        </label>
                                        {{ form.material_construction }}
                                    </div>
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text text-blue-950 font-semibold">Cost Factor</span>
                                        </label>
                                        {{ form.cost_factor }}
                                        <label class="label">
                                            <span class="label-text-alt text-gray-400">Adjustment for
                                                inflation/experience (Default: 1.0)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- 4.12.3 Affected Area Cost -->
                            <div class="mb-8">
                                <h4 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Affected Area Cost
                                </h4>
                                <div class="form-control max-w-md">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Equipment Cost
                                            ($/ft²)</span>
                                    </label>
                                    {{ form.equipment_cost_per_sqft }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">Replacement cost of surrounding
                                            equipment per ft²</span>
                                    </label>
                                </div>
                            </div>

                            <!-- 4.12.4 Production Loss Mean Cost -->
                            <div class="mb-8">
                                <h4 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Production Loss
                                    Mean Cost</h4>
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text text-blue-950 font-semibold">Production Cost
                                                ($/day)</span>
                                        </label>
                                        {{ form.production_cost_per_day }}
                                    </div>
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text text-blue-950 font-semibold">Outage
                                                Multiplier</span>
                                        </label>
                                        {{ form.outage_multiplier }}
                                        <label class="label">
                                            <span class="label-text-alt text-gray-400">Default: 1.0</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- 4.12.5 Personnel Injury Cost -->
                            <div class="mb-8">
                                <h4 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Personnel Injury
                                    Cost</h4>
                                <div class="grid grid-cols-2 gap-6 mb-4">
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text text-blue-950 font-semibold">Unit Area
                                                (ft²)</span>
                                        </label>
                                        {{ form.unit_area_safety }}
                                    </div>
                                    <div class="form-control">
                                        <label class="label">
                                            <span class="label-text text-blue-950 font-semibold">Injury Cost
                                                ($/person)</span>
                                        </label>
                                        {{ form.injury_cost_per_person }}
                                    </div>
                                </div>

                                <!-- Personnel Shifts Table -->
                                <div class="bg-gray-50 p-4 rounded border border-gray-200">
                                    <h5 class="font-semibold text-sm text-gray-700 mb-3">Personnel Density
                                        Calculator
                                    </h5>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text text-sm font-semibold">Shift 1
                                                    Personnel</span>
                                            </label>
                                            {{ form.personnel_shift_1 }}
                                        </div>
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text text-sm font-semibold">Shift 1 Time Present
                                                    (%)</span>
                                            </label>
                                            {{ form.time_present_shift_1 }}
                                        </div>
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text text-sm font-semibold">Shift 2
                                                    Personnel</span>
                                            </label>
                                            {{ form.personnel_shift_2 }}
                                        </div>
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text text-sm font-semibold">Shift 2 Time Present
                                                    (%)</span>
                                            </label>
                                            {{ form.time_present_shift_2 }}
                                        </div>
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text text-sm font-semibold">Maintenance
                                                    Personnel</span>
                                            </label>
                                            {{ form.personnel_maintenance }}
                                        </div>
                                        <div class="form-control">
                                            <label class="label">
                                                <span class="label-text text-sm font-semibold">Maintenance Time
                                                    Present
                                                    (%)</span>
                                            </label>
                                            {{ form.time_present_maintenance }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 4.12.6 Environmental Cleanup Cost -->
                            <div class="mb-8">
                                <h4 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Environmental
                                    Cleanup Cost</h4>
                                <div class="form-control max-w-md">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Environmental Cost
                                            ($/bbl)</span>
                                    </label>
                                    {{ form.environmental_cost_per_bbl }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">Applied only if liquid spill
                                            persists</span>
                                    </label>
                                </div>
                            </div>
                        </div>


                    </div>

                    <!-- Operating & Process Section (Hidden by default) -->
                    <div id="operating-section" class="hidden bg-white shadow-md rounded-lg p-6">
                        <h2
                            class="text-lg font-bold text-blue-950 mb-6 bg-purple-600 text-white py-2 px-4 -mx-6 -mt-6 rounded-t-lg">
                            Operating & Process</h2>

                        <!-- 4.1 Representative Fluids & Properties -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Representative Fluids &
                                Properties</h3>
                            <div class="grid grid-cols-3 gap-6">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Representative
                                            Fluid</span>
                                    </label>
                                    {{ form.representative_fluid }}
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Stored Phase</span>
                                    </label>
                                    {{ form.stored_phase }}
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Temperature (°F)</span>
                                    </label>
                                    {{ form.fluid_temperature }}
                                </div>
                            </div>
                        </div>

                        <!-- 4.2 Release Hole Size -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Release Hole Size & GFF
                            </h3>
                            <div class="form-control max-w-md">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Component Diameter
                                            (inches)</span>
                                    </label>
                                    {{ form.component_diameter }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">Component diameter for release
                                            hole
                                            calculation</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 4.3 Shared Release Rate Parameters -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Release Rate Parameters
                                (Shared)</h3>
                            <p class="text-xs text-gray-500 mb-4">Common parameters for both liquid and vapor
                                calculations</p>
                            <div class="grid grid-cols-3 gap-6">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Storage Pressure (Ps)
                                            [psia]</span>
                                    </label>
                                    {{ form.storage_pressure }}
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Atmospheric Pressure
                                            (Patm)
                                            [psi]</span>
                                    </label>
                                    {{ form.atm_pressure }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">Default: 14.7</span>
                                    </label>
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Discharge Coefficient
                                            (Cd)</span>
                                    </label>
                                    {{ form.discharge_coeff }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">Range: 0.60-1.0</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 4.3.2 Liquid Release Rate (Conditional) -->
                        <div id="liquid-release-section" class="mb-8 hidden">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Liquid Release Rate -
                                Specific Parameters
                            </h3>
                            <p class="text-xs text-gray-500 mb-4">Only applicable when stored phase is Liquid</p>
                            <div class="form-control max-w-md">
                                <label class="label">
                                    <span class="label-text text-blue-950 font-semibold">Viscosity Correction
                                        (Kvn)</span>
                                </label>
                                {{ form.viscosity_correction }}
                                <label class="label">
                                    <span class="label-text-alt text-gray-400">Recommended: 1.0</span>
                                </label>
                            </div>
                        </div>

                        <!-- 4.3.3 Vapor Release Rate (Conditional) -->
                        <div id="vapor-release-section" class="mb-8 hidden">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Vapor Release Rate -
                                Specific Parameters</h3>
                            <p class="text-xs text-gray-500 mb-4">Only applicable when stored phase is Vapor/Gas
                            </p>
                            <div class="form-control max-w-md">
                                <label class="label">
                                    <span class="label-text text-blue-950 font-semibold">Conversion Factor
                                        (C2)</span>
                                </label>
                                {{ form.conversion_factor_c2 }}
                                <label class="label">
                                    <span class="label-text-alt text-gray-400">Default: 1</span>
                                </label>
                            </div>
                        </div>

                        <!-- 4.4 Fluid Inventory -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Fluid Inventory
                            </h3>
                            <div class="grid grid-cols-2 gap-6">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Inventory Group
                                            Mass
                                            [lb]</span>
                                    </label>
                                    {{ form.inventory_group_mass }}
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Component Mass
                                            [lb]</span>
                                    </label>
                                    {{ form.component_mass }}
                                </div>
                            </div>
                        </div>

                        <!-- 4.8 Flammable Consequence -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Flammable
                                Consequence
                            </h3>
                            <div class="form-control max-w-md">
                                <label class="label">
                                    <span class="label-text text-blue-950 font-semibold">Mitigation System
                                        (Table
                                        4.10)</span>
                                </label>
                                {{ form.mitigation_system }}
                            </div>
                        </div>

                        <!-- 4.9 Toxic Consequence -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Toxic Consequence
                            </h3>
                            <p class="text-xs text-gray-500 mb-4">Only applicable if fluid is toxic</p>
                            <div class="form-control max-w-md">
                                <label class="label">
                                    <span class="label-text text-blue-950 font-semibold">Toxic Component Mass
                                        Fraction</span>
                                </label>
                                {{ form.toxic_mass_fraction }}
                                <label class="label">
                                    <span class="label-text-alt text-gray-400">Range: 0.0-1.0 (1.0 for pure
                                        toxic
                                        fluid)</span>
                                </label>
                            </div>
                        </div>


                    </div>

                    <!-- Inspection Section (Hidden by default) -->
                    <div id="inspection-section" class="hidden bg-white shadow-md rounded-lg p-6">
                        <h2
                            class="text-lg font-bold text-blue-950 mb-6 bg-purple-600 text-white py-2 px-4 -mx-6 -mt-6 rounded-t-lg">
                            Inspection</h2>

                        <!-- 4.6 Detection & Isolation Systems -->
                        <div class="mb-8">
                            <h3 class="text-md font-bold text-blue-950 mb-4 border-b pb-2">Detection &
                                Isolation
                                Systems</h3>
                            <p class="text-xs text-gray-500 mb-4">Assess impact of detection and isolation
                                systems on
                                release magnitude and duration (Tables 4.5, 4.6, 4.7)</p>

                            <div class="grid grid-cols-2 gap-6">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Detection
                                            Classification
                                            (Table 4.5)</span>
                                    </label>
                                    {{ form.detection_class }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">
                                            A: Instrumentation (Auto) | B: Detectors (Remote) | C:
                                            Visual/Marginal
                                        </span>
                                    </label>
                                </div>

                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text text-blue-950 font-semibold">Isolation
                                            Classification
                                            (Table 4.5)</span>
                                    </label>
                                    {{ form.isolation_class }}
                                    <label class="label">
                                        <span class="label-text-alt text-gray-400">
                                            A: Auto Isolation | B: Remote Manual | C: Manual Valves
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>


                </form>
            </div>
    </div>
    <!-- END MAIN CONTENT -->

    <script>
        function showSubTab(tabName, clickedButton) {
            // Hide all sections
            document.getElementById('design-section').classList.add('hidden');
            document.getElementById('operating-section').classList.add('hidden');
            document.getElementById('inspection-section').classList.add('hidden');

            // Show selected section
            document.getElementById(tabName + '-section').classList.remove('hidden');

            // Update button styles
            const buttons = document.querySelectorAll('[onclick^="showSubTab"]');
            buttons.forEach(btn => {
                btn.classList.remove('bg-blue-950', 'hover:bg-blue-900', 'text-white', 'shadow-md', 'font-semibold');
                btn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
            });

            // Highlight clicked button
            if (clickedButton) {
                clickedButton.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
                clickedButton.classList.add('bg-blue-950', 'hover:bg-blue-900', 'text-white', 'shadow-md', 'font-semibold');
            }
        }

        // Toggle Liquid/Vapor Release Rate sections based on Stored Phase
        document.addEventListener('DOMContentLoaded', function () {
            const storedPhaseSelect = document.getElementById('id_stored_phase');
            const liquidSection = document.getElementById('liquid-release-section');
            const vaporSection = document.getElementById('vapor-release-section');

            function toggleReleaseRateSections() {
                const selectedPhase = storedPhaseSelect.value;

                if (selectedPhase === 'Liquid') {
                    liquidSection.classList.remove('hidden');
                    vaporSection.classList.add('hidden');
                } else if (selectedPhase === 'Vapor') {
                    vaporSection.classList.remove('hidden');
                    liquidSection.classList.add('hidden');
                } else {
                    liquidSection.classList.add('hidden');
                    vaporSection.classList.add('hidden');
                }
            }

            // Initial check on page load
            if (storedPhaseSelect) {
                toggleReleaseRateSections();

                // Add event listener for changes
                storedPhaseSelect.addEventListener('change', toggleReleaseRateSections);
            }
        });
    </script>

    </main>
</div>
</div>
{% endblock %}