<h2 class="text-2xl font-bold text-primary mb-4 border-b pb-2">Step 3. Time in Service & Corrosion Rates</h2>
<p>
    Determine the time in service, age<sub>tk</sub>, since the last inspection and last known thickness,
    t<sub>rdi</sub>. The last known thickness is the furnished thickness, t, or measured thickness
    reading from a previous inspection, t<sub>rdi</sub>.
</p>
<br>
<p>
    1) Determine the date of the last inspection with a measured thickness and calculate the service age
    since the inspection, age<sub>tk</sub>, and the measured thickness, t<sub>rdi</sub>. If no measured thickness is
    available, set t<sub>rdi</sub> = t and age<sub>tk</sub> = age from Step 1.
</p>

<!-- Conditional UI -->
<div class="mt-6 p-4 bg-base-100 rounded-box border border-base-300">
    <div class="form-control w-full max-w-2xl">
        <label class="label">
            <span class="label-text font-bold text-lg">Is there a measured thickness reading from a previous
                inspection?</span>
        </label>
        <select id="step3_has_inspection" class="select select-bordered w-full max-w-sm">
            <option value="" disabled selected>Select Option</option>
            <option value="yes">Yes, I have inspection data</option>
            <option value="no">No, use furnished thickness (Step 1)</option>
        </select>
    </div>

    <!-- Case YES: Inspection Data -->
    <div id="step3_inspection_data_container"
        class="hidden mt-4 pl-4 border-l-4 border-primary bg-base-200 p-4 rounded-r-lg">
        <h4 class="font-bold mb-3">Previous Inspection Details</h4>

        <div class="flex flex-col md:flex-row gap-4">
            <div class="form-control w-full max-w-xs">
                <label class="label">
                    <span class="label-text">Date of Last Inspection</span>
                </label>
                <input type="date" id="step3_inspection_date" class="input input-bordered w-full" />
            </div>

            <div class="form-control w-full max-w-xs">
                <label class="label">
                    <span class="label-text">Measured Thickness (t<sub>rdi</sub>)</span>
                </label>
                <div class="input-group">
                    <input type="number" id="step3_trdi" class="input input-bordered w-full" step="any"
                        placeholder="e.g. 12.5" />
                    <span id="step3_unit_label">mm</span>
                </div>
            </div>
        </div>

        <div class="mt-4 flex justify-end">
            <button id="step3_calc_btn" class="btn btn-primary btn-sm">Calculate & Save</button>
        </div>
    </div>

    <!-- Result Container (Matching previous steps) -->
    <div id="step3_result_container" class="hidden mt-4 alert alert-info alert-soft m-3">
        <!-- JS will populate this -->
    </div>

</div>
<br>

<!-- Part 2: Corrosion Rates -->
<div id="step3_part2_container" class="mt-6 p-4 bg-base-100 rounded-box border border-base-300 hidden">
    <h3 class="text-lg font-semibold text-gray-700 mb-4">2. Corrosion Rates & Cladding Life</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Base Metal Corrosion Rate -->
        <div class="form-control">
            <label class="label">
                <span class="label-text font-bold">Base Material Corrosion Rate (C<sub>r,bm</sub>)</span>
            </label>
            <div class="input-group">
                <input type="number" id="step3_crbm" class="input input-bordered w-full" step="any" placeholder="0.0" />
                <span class="unit_corrosion">mpy</span>
            </div>
        </div>

        <!-- Cladding Corrosion Rate (Conditional) -->
        <div class="form-control hidden" id="step3_crcm_wrapper">
            <label class="label">
                <span class="label-text font-bold">Cladding Corrosion Rate (C<sub>r,cm</sub>)</span>
            </label>
            <div class="input-group">
                <input type="number" id="step3_crcm" class="input input-bordered w-full" step="any" placeholder="0.0" />
                <span class="unit_corrosion">mpy</span>
            </div>
        </div>
    </div>

    <div class="mt-4 flex justify-end">
        <button id="step3_part2_btn" class="btn btn-primary btn-sm">Calculate Age<sub>rc</sub></button>
    </div>

    <!-- Result Container for Part 2 -->
    <div id="step3_part2_result" class="hidden mt-4 alert alert-info alert-soft">
        <!-- JS populates -->
    </div>
</div>

<!-- Part 3: Internal Liner -->
<div id="step3_part3_container" class="mt-6 p-4 bg-base-100 rounded-box border border-base-300 hidden">
    <h3 class="text-lg font-semibold text-gray-700 mb-4">3. Internal Liner Remaining Life</h3>
    <p class="text-sm text-gray-500 mb-4">Calculate remaining life (age<sub>rc</sub>) based on liner condition and
        monitoring.
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Liner Type (Table 4.7) -->
        <div class="form-control w-full">
            <label class="label">
                <span class="label-text font-bold">Liner Type</span>
            </label>
            <select id="step3_liner_type" class="select select-bordered w-full">
                <option value="" disabled selected>Select Liner Type</option>
                <!-- Types populated from table47.JSON -->
            </select>
            <div id="step3_liner_subtype_container" class="hidden mt-2">
                <select id="step3_liner_subtype" class="select select-bordered w-full select-sm">
                    <option value="" disabled selected>Select Subtype</option>
                </select>
            </div>
        </div>

        <!-- Liner Condition (Table 4.8) -->
        <div class="form-control w-full">
            <label class="label">
                <span class="label-text font-bold">Liner Condition</span>
            </label>
            <select id="step3_liner_condition" class="select select-bordered w-full">
                <option value="" disabled selected>Select Condition</option>
                <option value="Good">Good</option>
                <option value="Average">Average</option>
                <option value="Poor">Poor</option>
            </select>
        </div>

        <!-- Online Monitor -->
        <div class="form-control w-full">
            <label class="label">
                <span class="label-text font-bold">Online Monitoring?</span>
            </label>
            <select id="step3_online_monitoring" class="select select-bordered w-full">
                <option value="no">No</option>
                <option value="yes">Yes (Effective)</option>
            </select>
        </div>

    </div>

    <div class="mt-4 flex justify-end">
        <button id="step3_part3_btn" class="btn btn-primary btn-sm">Calculate Liner age<sub>rc</sub></button>
    </div>

    <!-- Result Container for Part 3 -->
    <div id="step3_part3_result" class="hidden mt-4 alert alert-info alert-soft">
        <!-- JS populates -->
    </div>
</div>

</div>