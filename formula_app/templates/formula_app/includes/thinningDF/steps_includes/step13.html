<div class="flex flex-col h-full w-full">
    <div class="mb-4">
        <h2 class="text-2xl font-bold text-primary mb-4 border-b pb-2">Step 13. Final Thinning Damage Factor</h2>
        <p class="text-sm text-gray-600 mb-4">
            Determine the Final Thinning Damage Factor (D<sup>Thin</sup><sub>f</sub>) using Equation 2.20. Select the
            correct Thinning Mechanism to apply the appropriate Online Monitoring Factor (F<sub>OM</sub>).
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

            <!-- Left: Base DF & FOM -->
            <div class="flex flex-col gap-4">
                <div class="form-control">
                    <label class="label"><span class="label-text font-bold">Base DF
                            (D<sup>Thin</sup><sub>fB</sub>)</span></label>
                    <input type="text" id="step13_base_df" class="input input-bordered bg-gray-100" readonly />
                </div>

                <div class="p-4 bg-gray-50 rounded-box border border-gray-200">
                    <h3 class="font-bold text-gray-700 mb-2">Online Monitoring (F<sub>OM</sub>)</h3>

                    <!-- Mechanism Selector -->
                    <div class="form-control mb-2">
                        <label class="label"><span class="label-text">Thinning Mechanism</span></label>
                        <select id="step13_mechanism" class="select select-bordered w-full">
                            <!-- Populated from JSON -->
                            <option disabled selected>Select Mechanism...</option>
                        </select>
                    </div>

                    <!-- Method Selector -->
                    <div class="form-control">
                        <label class="label"><span class="label-text">Monitoring Method</span></label>
                        <select id="step13_om_method" class="select select-bordered w-full">
                            <option value="none">None / Ineffective</option>
                            <option value="kpv">Key Process Variable</option>
                            <option value="er_probes">Electrical Resistance Probes</option>
                            <option value="coupons">Corrosion Coupons</option>
                        </select>
                    </div>

                    <div class="mt-2 text-right">
                        <div class="badge badge-lg badge-neutral">Factor F<sub>OM</sub> = <span
                                id="step13_fom_val">1</span></div>
                    </div>
                </div>
            </div>

            <!-- Right: Adjustments (IP & DL) -->
            <div class="flex flex-col gap-4">

                <!-- Injection Points -->
                <div class="p-4 bg-gray-50 rounded-box border border-gray-200">
                    <div class="form-control">
                        <label class="label cursor-pointer justify-start gap-4">
                            <input type="checkbox" id="step13_check_ip" class="toggle toggle-primary" />
                            <span class="label-text font-bold">Injection / Mix Points?</span>
                        </label>
                    </div>

                    <div id="step13_ip_details" class="hidden mt-2 ml-2 pl-4 border-l-2 border-gray-300">
                        <p class="text-sm mb-2">Is there an effective inspection program specifically for injection
                            points?</p>
                        <div class="flex gap-4">
                            <label class="label cursor-pointer gap-2">
                                <input type="radio" name="ip_insp" value="yes" class="radio radio-sm" />
                                <span class="label-text">Yes (F<sub>IP</sub>=1)</span>
                            </label>
                            <label class="label cursor-pointer gap-2">
                                <input type="radio" name="ip_insp" value="no" class="radio radio-sm" checked />
                                <span class="label-text">No (F<sub>IP</sub>=3)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dead Legs -->
                <div class="p-4 bg-gray-50 rounded-box border border-gray-200">
                    <div class="form-control">
                        <label class="label cursor-pointer justify-start gap-4">
                            <input type="checkbox" id="step13_check_dl" class="toggle toggle-primary" />
                            <span class="label-text font-bold">Dead-legs?</span>
                        </label>
                    </div>

                    <div id="step13_dl_details" class="hidden mt-2 ml-2 pl-4 border-l-2 border-gray-300">
                        <p class="text-sm mb-2">Is there an effective inspection program specifically for dead-legs?</p>
                        <div class="flex gap-4">
                            <label class="label cursor-pointer gap-2">
                                <input type="radio" name="dl_insp" value="yes" class="radio radio-sm" />
                                <span class="label-text">Yes (F<sub>DL</sub>=1)</span>
                            </label>
                            <label class="label cursor-pointer gap-2">
                                <input type="radio" name="dl_insp" value="no" class="radio radio-sm" checked />
                                <span class="label-text">No (F<sub>DL</sub>=3)</span>
                            </label>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Calculation Action -->
        <div class="flex justify-end">
            <button id="step13_calc_btn" class="btn btn-primary">Calculate Final DF</button>
        </div>

        <!-- Error Container -->
        <div id="step13_error_container" class="alert alert-error hidden mb-4 mt-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="step13_error_message">Error!</span>
        </div>

        <!-- Final Result Container -->
        <div id="step13_result_container" class="hidden mt-6 flex justify-center">

            <div class="stats shadow border border-info bg-blue-50 w-full md:w-2/3">
                <div class="stat place-items-center">
                    <div class="stat-title text-info font-bold opacity-100">Final Thinning DF
                        (D<sup>Thin</sup><sub>f</sub>)</div>
                    <div class="stat-value text-info text-5xl"><span id="step13_result">0.00</span> <span
                            class="text-lg font-normal text-gray-400">(Dimensionless)</span></div>
                    <div class="stat-desc text-info opacity-100">Adjusted per Eq 2.20</div>
                </div>
            </div>

        </div>

    </div>
</div>