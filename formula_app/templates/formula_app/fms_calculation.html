{% extends 'theme/base.html' %}
{% load static %}

{% block title %}Management Systems Factor (FMS) Calculation{% endblock %}

{% block nav_content %}
<div class="flex justify-end items-center h-full">
    <ul class="menu menu-horizontal p-0 hidden lg:flex text-white space-x-2">
        <li><a id="logout_btn" href="{% url 'logout' %}"
                class="btn btn-ghost text-white hover:bg-blue-800 transition duration-200">Log out</a></li>
        <li><a href="#" class="btn btn-ghost text-white hover:bg-blue-800 transition duration-200">Account</a></li>
    </ul>

    <label for="my-drawer" class="btn btn-square btn-ghost text-white lg:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            class="inline-block w-6 h-6 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </label>
</div>
{% endblock %}

{% block content %}
<div class="drawer h-full overflow-hidden">
    <input id="my-drawer" type="checkbox" class="drawer-toggle" />

    <div class="drawer-content flex flex-col h-full overflow-hidden">

        <main class="flex flex-1 h-full overflow-hidden">

            <!-- SIDEBAR DESKTOP -->
            <aside
                class="hidden lg:block w-64 bg-white p-6 shadow-xl border-r border-gray-200 flex-shrink-0 overflow-y-auto">
                {% include 'formula_app/includes/sidebar.html' %}
            </aside>

            <!-- MAIN CONTENT SECTION -->
            <section id="main-content-section"
                class="flex flex-1 flex-col bg-gray-50 h-full overflow-hidden p-6 lg:p-10">

                <h1 class="text-2xl sm:text-3xl font-extrabold text-blue-800 mb-6 animate-fade-in flex-shrink-0">
                    Management Systems Factor (FMS)
                </h1>

                <div class="w-full flex-1 overflow-y-auto rounded-box bg-gray-50 space-y-4 p-2" id="fms-main-scroll">

                    <!-- FMS Questionnaire Container -->
                    <div id="fms-questionnaire-container" class="space-y-6">
                        <!-- Loading State -->
                        <div class="flex flex-col items-center justify-center p-12 text-gray-400">
                            <span class="loading loading-spinner loading-lg mb-4"></span>
                            <p>Loading Questionnaire Data...</p>
                        </div>
                    </div>

                    <!-- RESULTS CARD -->
                    <div id="fms-result-card"
                        class="card bg-blue-900 text-white shadow-xl mt-8 hidden transition-all duration-500 transform translate-y-4">
                        <div class="card-body">
                            <div class="flex flex-col md:flex-row justify-between items-center gap-6">

                                <!-- PSCORE -->
                                <div class="text-center md:text-left">
                                    <h3 class="font-bold text-blue-200 text-sm uppercase tracking-wider mb-1">Total
                                        Score (pscore)</h3>
                                    <div class="flex items-baseline gap-2 justify-center md:justify-start">
                                        <span class="text-4xl font-black tracking-tight"
                                            id="total-pscore-display">0.0</span>
                                        <span class="text-blue-300 font-medium">/ 100</span>
                                    </div>
                                    <progress class="progress progress-warning w-56 md:w-64 mt-2 h-2" value="0"
                                        max="100" id="pscore-progress"></progress>
                                </div>

                                <!-- FORMULA VISUAL -->
                                <div class="hidden md:block text-blue-300 font-mono text-sm opacity-75">
                                    Fms = 2.38 * e^(-0.012 * pscore)
                                </div>

                                <!-- FMS FACTOR -->
                                <div
                                    class="text-center md:text-right bg-blue-800 p-4 rounded-xl border border-blue-700 shadow-inner min-w-[200px]">
                                    <h3 class="font-bold text-yellow-400 text-sm uppercase tracking-wider mb-1">FMS
                                        Factor</h3>
                                    <p class="text-5xl font-black text-white tracking-tight" id="fms-factor-display">
                                        2.38</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

        </main>
    </div>

    <!-- SIDEBAR MOBILE/DRAWER -->
    <div class="drawer-side z-40">
        <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
        <aside class="w-64 bg-white p-4 shadow-2xl flex-shrink-0">
            {% include 'formula_app/includes/sidebar.html' %}
        </aside>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'formula_app/js/fms_calcs.js' %}"></script>
{% endblock %}